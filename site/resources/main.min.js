function dragObjectsSetUp(){Draggable.create(".object",{type:"x,y",edgeResistance:.65,bounds:"#objectContainer",throwProps:!0,liveSnap:!0,snap:{x:function(e){return Math.round(e/gridSize)*gridSize},y:function(e){return Math.round(e/gridSize)*gridSize}}})}function renderObjects(){var e="";$.each(objectsArray.data,function(t,n){e+="<div class='object "+n.objectType+"' style='left:"+(n.objectX===0?1:n.objectX*gridSize)+"px; top:"+n.objectY*gridSize+"px; background-color:"+n.objectColor+"; z-index:"+n.objectZIndex+";'>"+n.userName+"</div>"});$("#objectContainer").append(e);dragObjectsSetUp()}function getObjectsData(e){$.post("getObjects.php",{data:e},function(e){objectsArray=e;renderObjects()})}var objectsArray,gridSize=50,$objectContainer=$("#objectContainer"),windowWidth=$(window).width(),windowHeight=$(window).height(),screenWidth=screen.width,screenHeight=screen.height,gridColumns=Math.floor(screenWidth/gridSize)*2,gridRows=Math.floor(screenHeight/gridSize)*2;for(var i=0;i<gridRows*gridColumns;i++){var y=Math.floor(i/gridColumns)*gridSize,x=i*gridSize%(gridColumns*gridSize);$("<div/>").css({position:"absolute",border:"1px solid #454545",width:gridSize-1,height:gridSize-1,top:y,left:x}).prependTo($objectContainer)}TweenLite.set($objectContainer,{height:gridRows*gridSize+1,width:gridColumns*gridSize+1});var queryString=function(){var e={},t=window.location.search.substring(1),n=t.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(typeof e[i[0]]=="undefined")e[i[0]]=i[1];else if(typeof e[i[0]]=="string"){var s=[e[i[0]],i[1]];e[i[0]]=s}else e[i[0]].push(i[1])}return e}();queryString.location&&queryString.country?getObjectsData({localLocation:"false",location:queryString.location,country:queryString.country}):getObjectsData({localLocation:"true",location:userObject.location,country:userObject.country});$(window).load(function(){$("html, body").animate({scrollTop:$(document).height()},{duration:1e3,queue:!1});$("html, body").animate({scrollLeft:(gridColumns*gridSize-windowWidth)/2},{duration:1e3,queue:!1})});$(document).ready(function(){$("#dynamicAdd").click(function(){userObject.userName="A";userObject.objectType="square";userObject.objectX="1";userObject.objectY="1";userObject.objectColor="red";userObject.objectTexture="001";userObject.objectZIndex="0";JSON.stringify(userObject);$.post("postObject.php",{data:userObject},function(e){e.complete?$("#responseText").text(e.details):$("#responseText").text(e.details)});$objectContainer.append("<div class='object "+userObject.objectType+"' style='left:"+userObject.objectX+"px; top:"+userObject.objectY+"px; background-color:"+userObject.objectColor+";'>"+userObject.userName+"</div>");dragObjectsSetUp()})});